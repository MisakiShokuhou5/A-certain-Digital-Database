<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database v2.1</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        /* CSS ATUALIZADO PARA HIERARQUIA E NOVAS FUNCIONALIDADES */
        :root {
            --bg-main: #000000;
            --bg-sidebar: #1a1a2e;
            --bg-viewer: #161625;
            --text-color: #e0e0e0;
            --accent-color: #8a2be2; /* Blueviolet */
            --comment-color: #6c6c9c;
            --border-color: #4a2d8a;
            --glow-color: rgba(138, 43, 226, 0.5);
            --success-color: #2ecc71;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Consolas', 'Monaco', monospace; background-color: var(--bg-main); color: var(--text-color); overflow: hidden; }
        .hidden { display: none !important; }

        .app-container { display: grid; grid-template-columns: 320px 1fr; height: 100vh; }
        .sidebar { background-color: var(--bg-sidebar); border-right: 1px solid var(--border-color); display: flex; flex-direction: column; overflow: auto;}
        .sidebar-header { padding: 20px; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; gap: 10px; text-shadow: 0 0 8px var(--glow-color); }
        .sidebar-header i { color: var(--accent-color); font-size: 1.5rem; }
        .search-box { padding: 10px; }
        #file-search { width: 100%; padding: 8px; background-color: var(--bg-main); border: 1px solid var(--border-color); color: var(--text-color); border-radius: 4px; }
        #file-search:focus { outline: none; box-shadow: 0 0 10px var(--glow-color); }

        /* Árvore de Arquivos Hierárquica */
        .file-tree { flex-grow: 1; overflow-y: auto; padding: 10px; }
        .tree-node { list-style: none; }
        .folder-header { cursor: pointer; padding: 8px; font-weight: bold; display: flex; align-items: center; gap: 8px; border-radius: 4px; }
        .folder-header:hover { background-color: var(--bg-viewer); }
        .folder-header .icon { color: var(--accent-color); width: 20px; text-align: center; }
        .folder-header .toggle-icon { transition: transform 0.2s; }
        .folder-header.collapsed .toggle-icon { transform: rotate(-90deg); }
        .folder-content { padding-left: 20px; }
        .folder-content.collapsed { display: none; }
        .file-item { padding: 8px 8px 8px 25px; cursor: pointer; position: relative; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; border-radius: 4px; }
        .file-item:hover { background-color: var(--bg-viewer); }
        .file-item.active { background-color: var(--accent-color); color: white; font-weight: bold; }
        .file-item .icon { position: absolute; left: 8px; top: 50%; transform: translateY(-50%); color: var(--comment-color); }
        .file-item.active .icon { color: white; }

        /* Visualizador de Conteúdo */
        .content-viewer { background-color: var(--bg-viewer); padding: 20px; overflow-y: auto; display: flex; flex-direction: column; }
        #welcome-screen { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; color: var(--comment-color); text-align: center; }
        #welcome-screen .logo-animation i { font-size: 5rem; color: var(--accent-color); animation: spin 10s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        #viewer-content { flex-grow: 1; display: flex; flex-direction: column; }

        .viewer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }
        .viewer-header h3 { color: var(--accent-color); text-shadow: 0 0 5px var(--glow-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* ✨ NOVO: Container para todos os controles do cabeçalho */
        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .view-toggle button, .action-buttons button {
            background: none;
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 5px 12px;
            cursor: pointer;
            margin-left: 5px;
            border-radius: 4px;
            transition: all 0.2s ease;
            position: relative;
        }
        .view-toggle button:hover, .action-buttons button:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
            box-shadow: 0 0 8px var(--glow-color);
        }
        .view-toggle button.active {
            background-color: var(--accent-color);
            color: white;
            font-weight: bold;
            border-color: var(--accent-color);
        }
        
        /* ✨ NOVO: Estilos para botões de ação com ícones */
        .action-buttons button {
            padding: 8px 10px; /* Mais quadrado para ícones */
        }
        .action-buttons button .fas {
            font-size: 1rem;
            transition: opacity 0.2s;
        }
        .action-buttons button .feedback-icon {
            color: var(--success-color);
        }

        #file-content-display { flex-grow: 1; }
        #file-content-display img { max-width: 100%; border: 2px solid var(--border-color); border-radius: 8px; }
        #file-content-display pre { white-space: pre-wrap; word-wrap: break-word; background-color: var(--bg-main); padding: 15px; border-radius: 5px; border: 1px solid var(--border-color); }
        .formatted-view .anime-title { font-size: 2.5rem; color: var(--accent-color); text-shadow: 0 0 10px var(--glow-color); margin-bottom: 15px; }
        .formatted-view p { line-height: 1.6; margin-bottom: 20px; max-width: 90ch; }
        .formatted-view h4 { font-size: 1.5rem; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid var(--border-color); padding-bottom: 5px; }
        .episode-list-formatted { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 15px;}
        .episode-item-formatted { background: var(--bg-sidebar); padding: 15px; border-radius: 4px; border-left: 4px solid var(--accent-color); transition: background-color 0.2s; }
        .episode-item-formatted:hover { background-color: #2f314d; }
        .episode-item-formatted .ep-title { font-weight: bold; color: var(--text-color); display: block; margin-bottom: 5px; }
        .episode-item-formatted .ep-desc { font-size: 0.9em; color: var(--comment-color); }
    </style>
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <header class="sidebar-header">
                <i class="fas fa-sitemap"></i>
                <h2 id="project-name">Carregando Projeto...</h2>
            </header>
            <div class="search-box">
                <input type="text" id="file-search" placeholder="Buscar arquivo...">
            </div>
            <nav id="file-tree" class="file-tree"></nav>
        </aside>

        <main class="content-viewer">
            <div id="welcome-screen">
                <div class="logo-animation"><i class="fas fa-atom"></i></div>
                <h1>Selecione um arquivo para começar</h1>
                <p>Navegue pela árvore de arquivos à esquerda para carregar os dados.</p>
            </div>
            <div id="viewer-content" class="hidden">
                <header class="viewer-header">
                    <h3 id="file-path-display"></h3>
                    <div class="header-controls">
                        <div id="view-toggle-container" class="view-toggle">
                            <button id="view-formatted-btn" class="active">Formatado</button>
                            <button id="view-raw-btn">Raw JSON</button>
                        </div>
                        <div id="action-buttons-container" class="action-buttons">
                             <button id="copy-path-btn" title="Copiar Caminho do Arquivo"><i class="fas fa-link"></i></button>
                             <button id="copy-content-btn" title="Copiar Conteúdo JSON"><i class="fas fa-copy"></i></button>
                             <button id="generate-fetch-btn" title="Gerar Snippet Fetch"><i class="fas fa-code"></i></button>
                        </div>
                    </div>
                </header>
                <div id="file-content-display"></div>
            </div>
        </main>
    </div>

    <script>
    // JAVASCRIPT ATUALIZADO COM NOVAS FUNÇÕES DE CÓPIA
    document.addEventListener('DOMContentLoaded', () => {
        const fileTreeEl = document.getElementById('file-tree');
        const projectNameEl = document.getElementById('project-name');
        const welcomeScreen = document.getElementById('welcome-screen');
        const viewerContent = document.getElementById('viewer-content');
        const filePathDisplay = document.getElementById('file-path-display');
        const fileContentDisplay = document.getElementById('file-content-display');
        const viewToggleContainer = document.getElementById('view-toggle-container');
        const viewFormattedBtn = document.getElementById('view-formatted-btn');
        const viewRawBtn = document.getElementById('view-raw-btn');
        const actionButtonsContainer = document.getElementById('action-buttons-container');
        const copyPathBtn = document.getElementById('copy-path-btn');
        const copyContentBtn = document.getElementById('copy-content-btn');
        const generateFetchBtn = document.getElementById('generate-fetch-btn');

        let fileDatabase = {};
        let currentFile = null;
        let currentView = 'formatted';

        async function initialize() {
            try {
                const manifestResponse = await fetch('manifest.json');
                if (!manifestResponse.ok) throw new Error("manifest.json não encontrado.");
                const manifest = await manifestResponse.json();
                projectNameEl.textContent = manifest.project_name || "Database Local";

                const filesToLoad = [];
                function collectFiles(nodes) {
                    for (const node of nodes) {
                        if (node.type === 'file' && node.path.endsWith('.json')) {
                            filesToLoad.push(node.path);
                        } else if (node.type === 'folder' && node.children) {
                            collectFiles(node.children);
                        }
                    }
                }
                collectFiles(manifest.tree);
                
                const promises = filesToLoad.map(path => fetch(path).then(res => res.json()));
                const results = await Promise.all(promises);
                filesToLoad.forEach((path, index) => { fileDatabase[path] = results[index]; });

                buildFileTree(manifest.tree, fileTreeEl);

            } catch (error) {
                console.error("Erro na inicialização:", error);
                welcomeScreen.innerHTML = `<h1>Erro na Inicialização</h1><p style="color:red;">${error.message}</p>`;
            }
        }
        
        function buildFileTree(nodes, parentElement) {
            const ul = document.createElement('ul');
            ul.className = 'tree-node';
            
            for (const node of nodes) {
                const li = document.createElement('li');
                
                if (node.type === 'folder') {
                    li.innerHTML = `
                        <div class="folder-header collapsed">
                            <i class="fas fa-chevron-down icon toggle-icon"></i>
                            <i class="${node.icon || 'fas fa-folder'} icon"></i>
                            <span>${node.name}</span>
                        </div>
                        <div class="folder-content collapsed"></div>
                    `;
                    const folderHeader = li.querySelector('.folder-header');
                    const folderContent = li.querySelector('.folder-content');
                    
                    folderHeader.addEventListener('click', () => {
                        folderContent.classList.toggle('collapsed');
                        folderHeader.classList.toggle('collapsed');
                    });

                    if (node.children) {
                        buildFileTree(node.children, folderContent);
                    }
                } else if (node.type === 'file') {
                    li.innerHTML = `<div class="file-item" data-path="${node.path}"><i class="fas fa-file-alt icon"></i>${node.path.split('/').pop()}</div>`;
                    li.querySelector('.file-item').addEventListener('click', (e) => handleFileSelect(e.currentTarget, node.path));
                }
                ul.appendChild(li);
            }
            parentElement.appendChild(ul);
        }

        function handleFileSelect(element, filePath) {
            document.querySelectorAll('.file-item.active').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
            
            welcomeScreen.classList.add('hidden');
            viewerContent.classList.remove('hidden');
            
            filePathDisplay.textContent = filePath;
            currentFile = filePath;
            
            displayFileContent();
        }

        function displayFileContent() {
            if (!currentFile) return;
            
            viewFormattedBtn.classList.toggle('active', currentView === 'formatted');
            viewRawBtn.classList.toggle('active', currentView === 'raw');
            
            const fileExtension = currentFile.split('.').pop().toLowerCase();
            const isJson = fileExtension === 'json';

            viewToggleContainer.classList.toggle('hidden', !isJson);
            actionButtonsContainer.classList.toggle('hidden', !isJson);

            if (isJson) {
                const data = fileDatabase[currentFile];
                currentView === 'raw' ? renderRawJson(data) : renderFormattedJson(data);
            } else if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(fileExtension)) {
                renderImage(currentFile);
            } else {
                fileContentDisplay.innerHTML = `<p>Visualização não suportada.</p>`;
            }
        }
        
        function renderRawJson(data) {
            fileContentDisplay.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }
        function renderImage(filePath) {
            fileContentDisplay.innerHTML = `<img src="${filePath}" alt="${filePath}">`;
        }
        function renderFormattedJson(data) {
            const episodesHtml = (data.episodios || []).map(ep => `
                <div class="episode-item-formatted">
                    <span class="ep-title">Ep. ${ep.episodio || 'N/A'}: ${ep.titulo || 'Sem título'}</span>
                    <p class="ep-desc">${ep.descricao || 'Descrição não disponível.'}</p>
                </div>
            `).join('');
            fileContentDisplay.innerHTML = `
                <div class="formatted-view">
                    <h2 class="anime-title">${data.anime || 'Título Desconhecido'}</h2>
                    <p>${data.sinopse || 'Sinopse não disponível.'}</p>
                    <h4>Episódios</h4>
                    <div class="episode-list-formatted">${episodesHtml || 'Nenhum episódio listado.'}</div>
                </div>
            `;
        }
        
        function provideFeedback(button, originalIconClass) {
            const icon = button.querySelector('i');
            icon.className = 'fas fa-check feedback-icon';
            setTimeout(() => {
                icon.className = originalIconClass;
            }, 1500);
        }

        // --- Event Listeners ---
        document.getElementById('file-search').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            document.querySelectorAll('.file-item, .folder-header').forEach(item => {
                const text = item.textContent.trim().toLowerCase();
                const li = item.closest('li');
                if (li) {
                    li.style.display = text.includes(query) ? '' : 'none';
                }
            });
        });

        viewFormattedBtn.addEventListener('click', () => { currentView = 'formatted'; displayFileContent(); });
        viewRawBtn.addEventListener('click', () => { currentView = 'raw'; displayFileContent(); });

        copyPathBtn.addEventListener('click', () => {
            if (!currentFile) return;
            navigator.clipboard.writeText(currentFile).then(() => {
                provideFeedback(copyPathBtn, 'fas fa-link');
            });
        });

        copyContentBtn.addEventListener('click', () => {
            if (!currentFile || !fileDatabase[currentFile]) return;
            const content = JSON.stringify(fileDatabase[currentFile], null, 2);
            navigator.clipboard.writeText(content).then(() => {
                provideFeedback(copyContentBtn, 'fas fa-copy');
            });
        });

        generateFetchBtn.addEventListener('click', () => {
            if (!currentFile) return;
            
            // ✨ ALTERAÇÃO AQUI: Constrói a URL absoluta antes de criar o snippet.
            const absoluteUrl = new URL(currentFile, window.location.href).href;

            const fetchSnippet = `fetch('${absoluteUrl}')\n  .then(response => response.json())\n  .then(data => {\n    console.log(data);\n  });`;
            navigator.clipboard.writeText(fetchSnippet).then(() => {
                provideFeedback(generateFetchBtn, 'fas fa-code');
            });
        });

        initialize();
    });
</script>
</body>
</html>